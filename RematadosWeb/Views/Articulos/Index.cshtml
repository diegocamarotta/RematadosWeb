@model IEnumerable<RematadosWeb.Models.Articulo>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                Imagen
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Nombre)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Descripcion)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Precio)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Estado)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Categoria)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    <img src="@Url.Content(String.Format("~/photos/" + item.Id + ".jpg"))" onerror="this.src='/photos/sinimagen.jpg';" style="max-width:150px">
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Nombre)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Descripcion)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Precio)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Estado)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Categoria)
                </td>
                <td>




                    <a asp-action="Comprar" asp-route-id="@item.Id">Comprar</a>




                    <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                    <a asp-action="Details" asp-route-id="@item.Id">Details</a> |
                    <a asp-action="CancelarArticulo" asp-route-id="@item.Id">Cancelar</a> |
                    <a asp-action="AñadirAlCarrito" asp-route-id="@item.Id">Añadir al carrito</a>
                </td>
            </tr>
        }
    </tbody>
</table>







@{var arrayCategoria = Enum.GetValues(typeof(Categoria));
    List<Categoria> categorias = Enum.GetValues(typeof(Categoria)).Cast<Categoria>().ToList();

    int cantArray = arrayCategoria.Length;
    Int32 length = categorias.Count;


}





@foreach (var cat in categorias)
{




    @*<span>Categoria: @cat.ToString()</span>*@
    <h2 class="product-category"> @cat.ToString()</h2>
    <div  class="carousel" data-bs-ride="carousel">
        <div id="@cat.ToString()-inner" class="carousel-inner">





            @foreach (var i in Model.Where(i => i.Categoria == cat))
            {


                @if (Model.Where(i => i.Categoria == cat).First() == i)
                {

                    <div class="carousel-item active">
                        <div class="card">
                            <div class="img-wrapper">
                                <img src="@Url.Content(String.Format("~/photos/" + i.Id + ".jpg"))" class="d-block w-100" onerror="this.src='/photos/sinimagen.jpg';" />
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">@Html.DisplayFor(modelItem => i.Nombre)</h5>
                                <h5 class="card-title precio">@Html.DisplayFor(modelItem => i.Precio)</h5>
                                <p class="card-text">
                                    @Html.DisplayFor(modelItem => i.Descripcion)
                                </p>
                                <a asp-action="AñadirAlCarrito" class="btn btn-primary" asp-route-id="@i.Id">Añadir al carrito</a>
                            </div>
                        </div>
                    </div>
                    @*<div class="carousel-item active">
                            <div class="img-wrapper">
                                <img src="@Url.Content(String.Format("~/photos/" + i.Id + ".jpg"))" onerror="this.src='/photos/sinimagen.jpg';" class="d-block w-100  " alt="imagen">
                            </div>
                            <div class="carousel-caption d-none d-md-block">
                                <h5>@Html.DisplayFor(modelItem => i.Nombre)</h5>
                                <h4>@Html.DisplayFor(modelItem => i.Descripcion)</h4>
                                <h4>@Html.DisplayFor(modelItem => i.Precio)</h4>
                                <a asp-action="Comprar" class="btn btn-primary" asp-route-id="@i.Id">Comprar</a>
                                <a asp-action="AñadirAlCarrito" class="btn btn-primary" asp-route-id="@i.Id">Añadir al carrito</a>

                            </div>


                        </div>*@



                }
                else
                {
                    <div class="carousel-item">
                        <div class="card">
                            @*<a href="@Url.Action("AñadirAlCarrito", "Articulos")", new { id = "@i.Id" }>*@
                                <div class="img-wrapper">
                                    <img src="@Url.Content(String.Format("~/photos/" + i.Id + ".jpg"))" class="d-block w-100" onerror="this.src='/photos/sinimagen.jpg';" alt="...">
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">@Html.DisplayFor(modelItem => i.Nombre)</h5>
                                    <h5 class="card-title precio">@Html.DisplayFor(modelItem => i.Precio)</h5>
                                    <p class="card-text">
                                        @Html.DisplayFor(modelItem => i.Descripcion)
                                    </p>
                                    <a asp-action="AñadirAlCarrito" asp-route-id="@i.Id"><i class="glyphicon glyphicon-credit-card"></i>Añadir al carrito</a>
                                </div>
                                
                        </div>
                    </div>



                }

            }
        </div>

        @*<button class="carousel-control-prev" type="button" data-bs-target="#@cat.ToString()" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#@cat.ToString()" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>*@
        <a id="@cat.ToString()-prev" class="carousel-control-prev" href="#@cat.ToString()" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a id="@cat.ToString()-next" class="carousel-control-next" href="#@cat.ToString()" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>


    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <script>




        window["@cat.ToString()carouselWidth"]  = $(".carousel-inner")[0].scrollWidth;
        window["@cat.ToString()cardWidth"] = $(".carousel-item").width();
        window["@cat.ToString()scrollPosition"]  = 0;

        $("#@cat.ToString()-next").on("click", function () {
            if (window["@cat.ToString()scrollPosition"] < (window["@cat.ToString()carouselWidth"] - window["@cat.ToString()cardWidth"] * 4)) {
                window["@cat.ToString()scrollPosition"] += window["@cat.ToString()cardWidth"];
                $("#@cat.ToString()-inner").animate(
                    { scrollLeft: window["@cat.ToString()scrollPosition"] },
                    600
                );
            }
        });

        $("#@cat.ToString()-prev").on("click", function () {
            if (window["@cat.ToString()scrollPosition"] > 0) {
                window["@cat.ToString()scrollPosition"] -= window["@cat.ToString()cardWidth"];
                $("#@cat.ToString()-inner").animate(
                    { scrollLeft: window["@cat.ToString()scrollPosition"] },
                    600
                );
            }
        });





        @*var carouselWidth = $(".carousel-inner")[0].scrollWidth;
        var cardWidth = $(".carousel-item").width();
        var scrollPosition = 0;
        $("#@cat.ToString() .carousel-control-next").on("click", function () {
            if (scrollPosition < (carouselWidth - cardWidth * 4)) {
                scrollPosition += cardWidth;
                $(".carousel-inner").animate(
                    { scrollLeft: scrollPosition },
                    600
                );
            }
        });
        $("#@cat.ToString() .carousel-control-prev").on("click", function () {
            if (scrollPosition > 0) {
                scrollPosition -= cardWidth;
                $(".carousel-inner").animate(
                    { scrollLeft: scrollPosition },
                    600
                );
            }
        });*@

    </script>


}


